Preflight: checking Python dependencies
Installing Python dependencies...
Collecting msal (from -r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 1))
  Using cached msal-1.34.0-py3-none-any.whl.metadata (11 kB)
Requirement already satisfied: requests in /Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages (from -r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 2)) (2.32.5)
Collecting playwright (from -r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 3))
  Using cached playwright-1.55.0-py3-none-macosx_11_0_arm64.whl.metadata (3.5 kB)
Collecting python-dotenv (from -r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 4))
  Using cached python_dotenv-1.1.1-py3-none-any.whl.metadata (24 kB)
Collecting PyJWT<3,>=1.0.0 (from PyJWT[crypto]<3,>=1.0.0->msal->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 1))
  Using cached PyJWT-2.10.1-py3-none-any.whl.metadata (4.0 kB)
Collecting cryptography<49,>=2.5 (from msal->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 1))
  Downloading cryptography-46.0.2-cp311-abi3-macosx_10_9_universal2.whl.metadata (5.7 kB)
Requirement already satisfied: charset_normalizer<4,>=2 in /Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages (from requests->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 2)) (3.4.3)
Requirement already satisfied: idna<4,>=2.5 in /Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages (from requests->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 2)) (3.10)
Requirement already satisfied: urllib3<3,>=1.21.1 in /Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages (from requests->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 2)) (2.5.0)
Requirement already satisfied: certifi>=2017.4.17 in /Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages (from requests->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 2)) (2025.8.3)
Collecting cffi>=2.0.0 (from cryptography<49,>=2.5->msal->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 1))
  Using cached cffi-2.0.0-cp313-cp313-macosx_11_0_arm64.whl.metadata (2.6 kB)
Collecting pyee<14,>=13 (from playwright->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 3))
  Using cached pyee-13.0.0-py3-none-any.whl.metadata (2.9 kB)
Collecting greenlet<4.0.0,>=3.1.1 (from playwright->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 3))
  Using cached greenlet-3.2.4-cp313-cp313-macosx_11_0_universal2.whl.metadata (4.1 kB)
Collecting typing-extensions (from pyee<14,>=13->playwright->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 3))
  Using cached typing_extensions-4.15.0-py3-none-any.whl.metadata (3.3 kB)
Collecting pycparser (from cffi>=2.0.0->cryptography<49,>=2.5->msal->-r /Users/bro/PROJECTS/callreportcatcher/requirements.txt (line 1))
  Using cached pycparser-2.23-py3-none-any.whl.metadata (993 bytes)
Using cached msal-1.34.0-py3-none-any.whl (116 kB)
Downloading cryptography-46.0.2-cp311-abi3-macosx_10_9_universal2.whl (7.3 MB)
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 7.3/7.3 MB 345.9 kB/s  0:00:20
Using cached PyJWT-2.10.1-py3-none-any.whl (22 kB)
Using cached playwright-1.55.0-py3-none-macosx_11_0_arm64.whl (38.7 MB)
Using cached greenlet-3.2.4-cp313-cp313-macosx_11_0_universal2.whl (272 kB)
Using cached pyee-13.0.0-py3-none-any.whl (15 kB)
Using cached python_dotenv-1.1.1-py3-none-any.whl (20 kB)
Using cached cffi-2.0.0-cp313-cp313-macosx_11_0_arm64.whl (181 kB)
Using cached pycparser-2.23-py3-none-any.whl (118 kB)
Using cached typing_extensions-4.15.0-py3-none-any.whl (44 kB)
Installing collected packages: typing-extensions, python-dotenv, PyJWT, pycparser, greenlet, pyee, cffi, playwright, cryptography, msal
  WARNING: The script dotenv is installed in '/Users/bro/Library/Python/3.13/bin' which is not on PATH.
  Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location.
  WARNING: The script playwright is installed in '/Users/bro/Library/Python/3.13/bin' which is not on PATH.
  Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location.

Successfully installed PyJWT-2.10.1 cffi-2.0.0 cryptography-46.0.2 greenlet-3.2.4 msal-1.34.0 playwright-1.55.0 pycparser-2.23 pyee-13.0.0 python-dotenv-1.1.1 typing-extensions-4.15.0
Installing Playwright browsers...
Starting login_automation at Mon Oct  6 20:10:24 +05 2025
2025-10-06 20:10:25,002 - INFO - ‚úÖ All required environment variables loaded successfully
2025-10-06 20:11:13,145 - INFO - Authentication successful
2025-10-06 20:11:13,147 - INFO - Getting last 20 emails...
2025-10-06 20:11:15,291 - INFO - Retrieved 20 emails
2025-10-06 20:11:15,291 - INFO - Found 2 security code emails after filtering
‚úÖ Loaded credentials for: info@omadligroup.com
üåê Login URL: https://app.tidyyoursales.com/
üéØ Target URL: https://app.tidyyoursales.com/v2/location/wZfvILagnooxcUiLaxyk/reporting/call
üëÅÔ∏è Headless mode: False
üåê Opening login page...
üìù Filling login credentials...
üîê Submitting login form...
‚è≥ Waiting for OTP verification page...
‚úÖ OTP verification page loaded
üì§ Clicking 'Send Security Code' button...
‚úÖ Security code sent
‚è∞ Waiting 30 seconds for email to arrive...
üìß Getting latest OTP from email...
‚úÖ Latest OTP code found: 409482
üìß From: noreply@mg.tidyyourhomes.com
üìÖ Received: 2025-10-06T15:10:59Z
üî¢ Using OTP: 409482
‚å®Ô∏è Entering OTP code...
‚úÖ OTP entered successfully
‚è∞ Waiting 30 seconds for login processing...
Traceback (most recent call last):
  File "/Users/bro/PROJECTS/callreportcatcher/login_automation.py", line 301, in <module>
    asyncio.run(main())
    ~~~~~~~~~~~^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/Users/bro/PROJECTS/callreportcatcher/login_automation.py", line 293, in main
    success = await login_bot.login_with_otp()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/bro/PROJECTS/callreportcatcher/login_automation.py", line 288, in login_with_otp
    await browser.close()
  File "/Users/bro/Library/Python/3.13/lib/python/site-packages/playwright/async_api/_generated.py", line 14234, in close
    return mapping.from_maybe_impl(await self._impl_obj.close(reason=reason))
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/bro/Library/Python/3.13/lib/python/site-packages/playwright/_impl/_browser.py", line 241, in close
    raise e
  File "/Users/bro/Library/Python/3.13/lib/python/site-packages/playwright/_impl/_browser.py", line 238, in close
    await self._channel.send("close", None, {"reason": reason})
  File "/Users/bro/Library/Python/3.13/lib/python/site-packages/playwright/_impl/_connection.py", line 69, in send
    return await self._connection.wrap_api_call(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/bro/Library/Python/3.13/lib/python/site-packages/playwright/_impl/_connection.py", line 558, in wrap_api_call
    raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
Exception: Browser.close: Connection closed while reading from the driver
Finished with exit code 1 at Mon Oct  6 20:11:23 +05 2025
